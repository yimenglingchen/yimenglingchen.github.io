---

layout: post

title:  设计模式之代理模式

tag: 设计模式

---

# 设计模式之代理模式

---

## 1 代理模式定义

```
代理模式的定义：为其他对象提供一种代理以控制对这个对象的访问。
```

---

## 2 程序示例

定义被代理的目标接口

```java
/**
 * 抽象的目标接口，定义具体的目标对象和代理公用的接口
 */
public interface Subject {
    public void request();
}
```

定义被代理的目标接口实现

```java
/**
 * 具体的目标对象，是真正被代理的对象
 */
public class RealSubject implements Subject{
    @Override
    public void request() {
        //执行具体的功能处理
    }
}
```

实现代理对象

```java
/**
 * 代理对象
 */
public class Proxy {

    private RealSubject realSubject = null;

    /**
     * 构造方法，传入被代理的具体的目标对象
     * @param realSubject 被代理的具体的目标对象
     */
    public Proxy(RealSubject realSubject) {
        this.realSubject = realSubject;
    }

    public void request() {
        //在转调具体的目标对象前，可以执行一些功能处理
        
        //转调具体的目标对象的方法
        realSubject.request();

        //在转调具体的目标对象后，可以执行一些功能处理
    }
}
```

---

## 3 代理模式讲解

### 3.1 代理模式的主要功能

代理模式的功能：代理模式是通过创建一个代理对象，用这个代理对象去代表真实的对象，客户端得到这个代理对象后，对客户端并没什么影响，就跟得到了真实对象一样来使用。

当客户端操作这个代理对象的时候，实际上功能最终还是会由真实的对象来完成，只不过是通过代理操作的，也就是客户端操作代理，代理操作真正的对象。

### 3.2 代理模式的结构

Proxy：代理对象，实现与具体的目标对象一样的接口，这样就可以使用代理来替代具体的目标对象。保留一个指向具体目标对象的引用，可以在需要的时候调用具体的目标对象。

Subject：目标接口，定义代理和具体目标对象的接口，这样就可以在任何使用具体目标对象的地方使用代理对象。

RealSubject：具体的目标对象，真正实现目标接口要求的功能。

### 3.3 代理模式的分类

虚代理：根据需要来创建开销很大的对象，该对象只有在需要的时候才会被真正创建。

远程代理：用来在不同的地址空间上代表同一个对象，这个不同的地址空间可以在本机，也可以在其他机器上。在java里最典型的就是RMI技术。

copy-on-write代理：在客户端操作的时候，只有对象确实改变了，才会真的拷贝一个目标对象，算是虚代理的一个分支。

保护代理：控制对原始对象的访问，如果有需要，可以给不同的用户提供不同的访问权限，以控制他们对原始对象的访问。

Cache代理：为那些昂贵操作的结果提供临时的存储空间，以便多个客户端可以共享这些结果。

防火墙代理：保护对象不被恶意用户访问和操作。

同步代理：使多个用户能够同时访问目标对象而没有冲突。

智能指引：在访问对象时执行一些附加操作。

### 3.4 代理模式的本质

代理模式的本质：控制对象访问。

### 3.7 何时采用代理模式

1.需要为一个对象在不同的地址空间提供局部代表的时候，可以使用远程代理。

2.需要按照需要创建开销很大的对象的时候，可以使用虚代理。

3.需要控制对原始对象的访问的时候，可以使用保护代理。

4.需要在访问对象执行一些附加操作的时候，可以使用智能指引代理。