---

layout: post

title:  设计模式之命令模式

tag: 设计模式

---

# 设计模式之命令模式

---

## 1 命令模式定义

```
命令模式的定义：将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化，对请求排队或记录请求日志，以及支持可撤销的操作。
```

---

## 2 程序示例

命令接口

```java
/**
 * 命令接口，声明执行的操作
 */
public interface Command {
    /**
     * 执行命令对应的操作
     */
    public void execute();
}
```

具体的命令执行对象

```java
/**
 * 具体的命令实现对象
 */
public class ConcreteCommand implements Command{
    /**
     * 持有相应的接收者对象
     */
    private Receiver receiver = null;
    /**
     * 示意，命令对象可以有自己的状态
     */
    private String state;

    public ConcreteCommand(Receiver receiver) {
        this.receiver = receiver;
    }

    @Override
    public void execute() {
        //通常会转调接收者对象的相应方法，让接收者来真正执行功能
        receiver.action();
    }
}
```

定义接收者对象

```java
/**
 * 接收者对象
 */
public class Receiver {
    public void action() {
        //真正执行命令操作的功能代码
    }
}
```

定义调用者对象

```java
/**
 * 调用者
 */
public class Invoker {
    /**
     * 持有命令对象
     */
    private Command command = null;

    public void setCommand(Command command) {
        this.command = command;
    }

    /**
     * 示意方法，要求命令执行请求
     */
    public void runCommand() {
        //调用命令对象的执行方法
        command.execute();
    }
}
```

客户端，创建命令对象并设定接收者

```java
public class Client {
    /**
     * 示意，负责创建命令对象，并设定它的接收者
     */
    public void assemble() {
        //创建接收者
        Receiver receiver = new Receiver();
        //创建命令对象，设定它的接收者
        Command command = new ConcreteCommand(receiver);
        //创建Invoker，把命令对象设置进去
        Invoker invoker = new Invoker();
        invoker.setCommand(command);
    }
}
```

---

## 3 命令模式讲解

### 3.1 命令模式的关键

命令模式的关键之处就是把请求封装成为对象，也就是命令对象，并定义了统一的执行操作的接口。

### 3.2 命令模式的参数化配置

参数化配置指的是，可以用不同的命令对象，去参数化配置客户的请求。

### 3.3 命令模式的可撤销操作

可撤销操作的意思就是：放弃该操作，回到执行操作之前的状态。现在有两种方案实现可撤销的操作：

1.补偿式，又称反操作式，通过反向操作来回滚操作。

2.存储恢复式，将操作前的状态记录下来，然后撤销操作的时候直接恢复。

### 3.4 宏命令

宏命令是包含多个命令的命令，是一个命令的组合。

宏命令究其本质还是一个命令，所以一样要实现Command接口。

宏命令和普通命令的不同在于：宏命令式多个命令组合起来的，因此宏命令对象里面会记录多个组成它的命令对象。

既然是包含多个命令对象，得有办法让这么多命令对象能被组合进来。

既然宏命令包含了多个命令对象，执行宏命令对象就相当于依次执行这些命令对象，也就是循环执行这些命令对象。

### 3.5 队列请求

队列请求就是对命令对象进行排队，组成工作队列，然后依次取出命令对象来执行。

### 3.6 命令模式的本质

命令模式的本质：封装请求。

### 3.7 命令模式的优缺点

#### 3.7.1 命令模式的优点

更松散的耦合：

命令模式使得发起命令的对象——客户端，和具体实现命令的对象——接收者对象完全解耦。

更动态的控制：

命令模式把请求封装起来，可以动态地对它进行参数化、队列化和日志化等操作，从而使得系统更灵活。

很自然的复合命令：

命令模式中的命令对象能够很容易地组合成复合命令，也就是前面讲的宏命令，从而使系统操作更简单，功能更强大。

更好的扩展性：

因为发起命令的对象和具体的实现完全解耦，因此扩展新的命令就很容易，只需要实现新的命令对象。

### 3.8 何时采用命令模式

1.如果需要抽象出需要执行的动作，并参数化这些对象，可以选用命令模式，将这些需要执行的动作抽象成为命令，然后实现命令的参数化配置。

2.如果需要在不同的时刻指定、排列和执行请求，可以选用命令模式，将这些请求封装成为命令对象，然后实现将请求队列化。

3.如果需要支持取消操作，可以选用命令模式，通过管理命令对象，能很容易地实现命令的恢复和重做功能。

4.如果需要支持当系统崩溃时，能将系统的操作功能重新执行一遍，可以选用命令模式。

5.在需要事务的系统中，可以选用命令模式。命令模式提供对事务进行建模的方法。命令模式有一个别名就是Transaction。