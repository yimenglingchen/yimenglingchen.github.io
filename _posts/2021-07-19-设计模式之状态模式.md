---

layout: post

title:  设计模式之状态模式

tag: 设计模式

---

# 设计模式之状态模式

---

## 1 状态模式定义

```
状态模式的定义：允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它的类。
```

---

## 2 程序示例

状态接口示例

```java
/**
 * 封装与Context的一个特定状态相关的行为
 */
public interface State {

    /**
     * 状态对应的处理
     * @param sampleParameter 示例参数，说明可以传入参数，具体传入什么参数由具体应用具体分析
     */
    public void handle(String sampleParameter);
}
```

状态的具体实现

```java
/**
 * 实现一个与Context的一个特定状态相关的行为
 */
public class ConcreteStateA implements State{
    @Override
    public void handle(String sampleParameter) {
        //实现具体的处理
    }
}

/**
 * 实现一个与Context的一个特定状态相关的行为
 */
public class ConcreteStateB implements State{
    @Override
    public void handle(String sampleParameter) {
        //实现具体的处理
    }
}
```

上下文具体实现

```java
/**
 * 定义客户感兴趣的接口，通常会维护一个State类型的对象实例
 */
public class Context {

    /**
     * 持有一个state类型的对象实例
     */
    private State state;

    /**
     * 设置实现State的对象的实例
     * @param state 实现State的对象的实例
     */
    public Context(State state) {
        this.state = state;
    }

    /**
     * 用户感兴趣的接口方法
     * @param sampleParameter 示意参数
     */
    public void request(String sampleParameter) {
        //在处理中，会转调state来处理
        state.handle(sampleParameter);
    }
}
```

---

## 3 状态模式讲解

### 3.1 状态模式的功能

状态模式的功能就是分离状态的行为，通过维护状态的变化，来调用不同状态对应的不同功能。

### 3.2 行为的平行性

行为是平行性的，是不可以相互替换的。

### 3.3 状态的维护和转换控制

可以将状态的维护放在状态的处理类中，指定后继状态，让应用正确处理后续的请求。

如果状态转换的规则是一定的，一般不需要进行扩展，那么就适合在上下文中统一进行状态的维护。

如果状态的转换取决于前一个状态动态处理的结果，或者依赖于外部数据，为了增强灵活性，这种情况下，一般是在状态处理类中进行状态的维护。

### 3.4 状态模式的本质

状态模式的本质：根据状态来分离和选择行为。

### 3.5 状态模式的优缺点

#### 3.5.1 状态模式的优点

简化应用逻辑控制：

状态模式使用单独的类来封装一个状态的处理。

更好地分离状态和行为：

状态模式通过设置所有状态类的公共接口，把状态和状态对应的行为分离开，把所有与一个特定的状态相关的行为都放入一个对象中，使得应用在控制的时候，只需要关心状态的切换，而不用关心这个状态对应的真正处理。

更好的扩展性：

引入状态处理的公共接口后，扩展新的状态就很容易，只需要新增加一个实现状态处理的公共接口的实现类，然后在进行状态维护的地方，设置状态变化到这个新的状态即可。

显式化进行状态转换：

状态模式为不同的状态引入独立的对象，使得状态的转换变得更加明确。而且状态对象可以保证上下文不会发生内部状态不一致的情况，因为上下文中只有一个变量来记录状态对象，只要为这一个变量赋值就可以了。


#### 3.5.2 状态模式的缺点

一个状态对应一个处理类，会使得程序引入太多的状态类，变得杂乱。

### 3.6 何时采用状态模式

1.如果一个对象的行为取决于它的状态，而且它必须在运行时刻根据状态来改变它的行为，可以使用状态模式，把状态和行为分离开。

2.如果一个操作中含有庞大的多分支语句而且这些分支依赖于该对象的状态，可以使用状态模式。