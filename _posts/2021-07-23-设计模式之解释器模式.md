---

layout: post

title:  设计模式之解释器模式

tag: 设计模式

---

# 设计模式之解释器模式

---

## 1 解释器模式定义

```
解释器模式的定义：给定一个语言，定义它的文法的一种表示，并定义一个解释器，这个解释器使用该表示来解释语言中的句子。
```

---

## 2 程序示例

首先定义一个抽象表达式，定义一个执行解释的方法

```java
public abstract class AbstractExpression {
    /**
     * 抽象表达式
     * @param context 上下文对象
     */
    public abstract void interpret(Context context);
}
```

定义终结符表达式

```java
/**
 * 终结符表达式
 */
public class TerminalExpression extends AbstractExpression{
    @Override
    public void interpret(Context context) {
        //实现与语法规则中的终结符相关联的解释操作
    }
}
```

定义非终结符表达式

```java
/**
 * 非终符表达式
 */
public class NonterminalExpression extends AbstractExpression{
    @Override
    public void interpret(Context context) {
        //实现与语法规则中的非终符相关联的解释操作
    }
}
```

定义上下文

```java
/**
 * 上下文，包含解释器之外的一些全局信息
 */
public class Context {
}
```

定义客户端

```java
/**
 * 使用解释器的客户
 */
public class Client {
    //主要按照语法规则对特定的句子构建抽象语法树
    //然后调用解释操作
}
```

因为解释器模式的代码需要具体到实际规则，因此没有贴业务代码，具体代码操作可参考demo

---

## 3 解释器模式讲解

### 3.1 解释器模式的功能

解释器模式使用解释器对象来表示和处理相应的语法规则，一般一个解释器处理一条语法规则。

语法规则和解释器之间是有对应关系的，一般一个解释器处理一条语法规则，但是犯规来并不成立，一条语法规则可以有多种解释和处理的，也就是一条语法规则可以对应多个解释器对象。

### 3.2 解析器

解析器：指的是把描述客户端调用要求的表达式，经过解析，形成一个抽象语法树的程序，不是指xml的解析器。

解释器：指的是解释抽象语法树，并执行每个节点对应的功能的程序。

要解决通用解析xml的问题：

第一步：需要先设计一个简单的表达式语言，在客户端调用解析程序的时候，传入用这个表达式语言描述的一个表达式，然后把这个表达式通过解析器的解析，形成一个抽象的语法树。

第二步：解析完成后，自动调用解释器来解释抽象语法树，并执行每个节点所对应的功能，从而完成通用的xml解析。

这样一来，每次当xml结构发生了更改，也就是在客户端调用的时候，传入不同的表达式即可，整个解析xml过程的代码都不需要再修改了。

解释器模式使用解释器对象来表示和处理相应的语法规则，一般一个解释器处理一条语法规则。

解析器实现思路：

1.把客户端传递来的表达式进行分解，分解成为一个一个的元素，并用一个对应的解析模型来封装这个元素的一些信息。

2.根据每个元素的信息，转化成相对应的解析器对象。

3.按照先后顺序，把这些解析器对象组合起来，就得到抽象语法树了。

### 3.3 解析器模式的本质

解释器模式的本质：分离实现，解释执行。

### 3.4 解析器模式的优缺点

#### 3.4.1 解析器模式的优点

易于实现语法，只需要考虑语法规则的实现就可以了，其他的都不用管。

易于扩展新的语法，只需要创建新的解释器对象，就可以扩展新的语法。

#### 3.4.2 解析器模式的缺点

不适合复杂的语法，如果语法特别复杂，构建解释器模式需要的抽象语法树的工作是非常艰巨的，再加上有可能会需要构建多个抽象语法树，所以解释器模式不太适合于复杂的语法。

### 3.5 何时采用解释器模式

当一个语言需要解释执行，并且可以将该语言中的句子表示为一个抽象语法树的时候，可以考虑使用解释器模式。

在使用解释器模式的时候，还有两个特点需要考虑：

1.语法相对比较简单，太复杂的语法不适合使用解释器模式。

2.效率要求不是很高，对效率要求很高的情况下，不适合使用解释器模式。